#include "MAPL_Exceptions.h"

! These are the possbile datetime strings:
! 2000-04-21T21:00:00              datetime with -, T, & delimiters
! 20000421 210000              datetime without delimiters
! This is how integer hour, min, & sec values are converted to an integer time.
! time = hour*10000+min*100+sec              datetime with -, T, & delimiters
! This is how integer year, month, & day values are converted to an integer day.
! date = year*10000+month*100+day              datetime with -, T, & delimiters
! These are datetime iterval strings:
! PnYnMnDTnHnMnSn  ! This is a fully expressed datetime interval string.
! P1D              ! This is a day-only interval string.
! PT30             ! This is a time-only interval string.

module Test_TimeStringConversion
    use ESMF
    use MAPL_ExceptionHandling
    use MAPL_TimeStringConversion
    use funit
    implicit none
    private

    public :: test_string_to_integer_time_nodelimiters
    public :: test_string_to_integer_time_delimiters
    public :: test_string_to_integer_date_nodelimiters
    public :: test_string_to_integer_date_delimiters
    public :: test_string_to_esmf_time
    public :: test_string_to_esmf_timeinterval

    integer :: YEAR_FACTOR      = 10000
    integer :: MONTH_FACTOR     =   100
    integer :: DAY_FACTOR       =     1

    integer :: HOUR_FACTOR      = 10000
    integer :: MINUTE_FACTOR    =   100
    integer :: SECOND_FACTOR    =     1

    logical :: TRUE             = is(true())
    logical :: FALSE            = is(false())
contains

    @test
    subroutine test_string_to_integer_time_nodelimiters()
        character(len=*) :: time_string = '21:00:00'
        integer :: integer_time = -1

        integer_time = 21*HOUR_FACTOR + 0*MINUTE_FACTOR + 0*SECOND_FACTOR
         
        @assert_that(string_to_integer_time(time_string) == integer_time, TRUE)

    end subroutine test_string_to_integer_time_nodelimiters

    @test
    subroutine test_string_to_integer_time_delimiters()
        character(len=*) :: time_string = '210000'
        integer :: integer_time

        integer_time = 21*HOUR_FACTOR + 0*MINUTE_FACTOR + 0*SECOND_FACTOR
         
        @assert_that(string_to_integer_time(time_string) == integer_time, TRUE)

    end subroutine test_string_to_integer_time_delimiters

    @test
    subroutine test_string_to_integer_date_delimiters()
        character(len=*) :: date_string = '2000-04-21'
        integer :: integer_date

        integer_date = 2000*YEAR_FACTOR + 4*MONTH_FACTOR + 0*DAY_FACTOR

        @assert_that(string_to_integer_date(date_string) == integer_date, TRUE)

    end subroutine test_string_to_integer_date_delimiters

    @test
    subroutine test_string_to_integer_date_nodelimiters()
        character(len=*) :: date_string = '20000421'
        integer :: integer_date

        integer_date = 2000*YEAR_FACTOR + 4*MONTH_FACTOR + 0*DAY_FACTOR

        @assert_that(string_to_integer_date(date_string) == integer_date, TRUE)

    end subroutine test_string_to_integer_date_nodelimiters

    @test
    subroutine test_string_to_esmf_time()
        character(len=*) :: time_string
        type(ESMF_Time) :: time_esmf
    end subroutine test_string_to_esmf_time

    @test
    subroutine test_string_to_esmf_timeinterval()
        character(len=*) :: time_interval_string
        type(ESMF_TimeInterval) :: time_interval_esmf
    end subroutine test_string_to_esmf_timeinterval

end module Test_TimeStringConversion
