#include "MAPL_TestErr.h"

module Test_WeightComputation

   use mapl3g_VerticalRegridMethod
   use mapl3g_CSR_SparseMatrix
   use mapl3g_WeightComputation, only: get_weights_fixedlevels_to_fixedlevels_linear
   use funit
   use, intrinsic :: iso_fortran_env, only: REAL32

   implicit none

contains

   @test
   subroutine test_get_weights_fixedlevels_subset()

      ! type(CSR_SparseMatrix_sp) :: weights
      real(REAL32), allocatable :: vcoord_src(:), vcoord_dst(:), result(:)
      real(REAL32), allocatable :: weights(:, :)
      integer :: status

      vcoord_src = [40., 30., 20., 10.]
      vcoord_dst = [40., 38., 32., 25., 21., 13., 10.]
      call get_weights_fixedlevels_to_fixedlevels_linear(vcoord_src, vcoord_dst, weights, _RC)
      ! print *, "weights: ", weights
      ! result = matmul(weights, vcoord_src)
      ! print *, "result: ", result
      @assertEqual(matmul(weights, vcoord_src), vcoord_dst)

   end subroutine test_get_weights_fixedlevels_subset

end module Test_WeightComputation
