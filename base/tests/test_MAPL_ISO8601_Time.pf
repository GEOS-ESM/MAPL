#include "MAPL_Exceptions.h"

module test_MAPL_ISO8601_Time
     use MAPL_ExceptionHandling
     use MAPL_ISO8601_Time
     use funit
     implicit none

contains

   @test
   subroutine test_date_fields()
      integer :: y
      integer :: m
      integer :: d
      type(date_fields) :: df
      
      y = 2022
      m = 06
      d = 27
      
      df = date_fields(y, m, d)

      @assertEqual(y, df % year)
      @assertEqual(m, df % month)
      @assertEqual(d, df % day)

   end subroutine test_date_fields

   @test
   subroutine test_date_fields_custom_constructor()
      type(date_fields) :: df
      integer, dimension(3) :: f = [2022, 06, 27]
      
      df = date_fields(f)

      @assertEqual(f(1), df % year)
      @assertEqual(f(2), df % month)
      @assertEqual(f(3), df % day)

   end subroutine test_date_fields_custom_constructor

   @test
   subroutine test_time_fields()
      integer :: h
      integer :: m
      integer :: s
      integer :: ms
      type(time_fields) :: tf
      
      h = 13
      m = 02
      s = 27
      ms = 37
      
      tf = time_fields(h, m, s, ms)

      @assertEqual(h, tf % hour)
      @assertEqual(m, tf % minute)
      @assertEqual(s, tf % second)
      @assertEqual(ms, tf % millisecond)

   end subroutine test_time_fields

   @test
   subroutine test_time_fields_custom_constructor()
      type(time_fields) :: tf
      integer, dimension(4) :: f = [13, 02, 27, 36]
      
      tf = time_fields(f)

      @assertEqual(f(1), tf % hour)
      @assertEqual(f(2), tf % minute)
      @assertEqual(f(3), tf % second)
      @assertEqual(f(4), tf % millisecond)

   end subroutine test_time_fields_custom_constructor

   @test
   subroutine test_is_digit()
     character :: c = '0' 
     @assertTrue(is_digit(c))
   end subroutine test_is_digit

   @test
   subroutine test_is_digit_before1()
      integer :: i0 = -1
      character :: c
      i0 = iachar('0')
      c = achar(i0-1)
      
      @assertFalse(is_digit(c))

   end subroutine test_is_digit_before1

   @test
   subroutine test_is_digit_before2()
      integer :: i0 = -1
      character :: c
      i0 = iachar('0')
      c = achar(i0-2)
      
      @assertFalse(is_digit(c))

   end subroutine test_is_digit_before2

   @test
   subroutine test_is_digit_after1()
      integer :: i0 = -1
      character :: c
      i0 = iachar('9')
      c = achar(i0+1)
      
      @assertFalse(is_digit(c))

   end subroutine test_is_digit_after1

   @test
   subroutine test_is_digit_after2()
      integer :: i0 = -1
      character :: c
      i0 = iachar('9')
      c = achar(i0+2)
      
      @assertFalse(is_digit(c))
   end subroutine test_is_digit_after2

end module test_MAPL_ISO8601_Time
