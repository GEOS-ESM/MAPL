module Test_udunits2

   use funit
   use udunits2mod
   ! The instances from iso_c_binding are not explicitly included in an include
   ! statement, to verify that the use statement for the module being tested
   ! is correct.
   use, intrinsic :: iso_c_binding, only: c_ptr, c_null_ptr

   implicit none

   integer(ut_encoding) :: encoding = UT_ASCII
   type(ut_system) :: utsys 

contains

   @Before
   subroutine set_up()
      encoding = UT_ASCII
   end subroutine set_up

   @Test
   subroutine test_ut_read_xml()
      type(c_ptr) :: path = c_null_ptr
      integer(ut_status) :: ustat
      
      utsys = ut_read_xml(path)
      ustat = ut_get_status()
      @assertEqual(ustat, UT_SUCCESS, 'Failed to get ut_system')

   end subroutine test_ut_read_xml

   @Test
   subroutine test_us_get_status()
      integer(ut_status) :: ustat
      
      ustat = ut_get_status()
      @assertEqual(ustat, UT_SUCCESS, 'ut_get_status should return UT_SUCCESS')

   end subroutine test_us_get_status

   @Test
   subroutine test_ut_parse()
      type(ut_system) :: utsys
      character(c_char), parameter :: string = 'kilogram'
      integer(ut_encoding) :: encoding
      type(c_ptr) :: path = c_null_ptr
      type(ut_unit) :: unit0
      integer(ut_status) :: ustat

      utsys = ut_read_xml(path)
      unit0 = ut_parse(utsys, string, encoding)
      ustat = ut_get_status()
      @assertEqual(ustat, UT_SUCCESS, 'Unsuccessful')
      
   end subroutine test_ut_parse

   @After
   subroutine tear_down()
      encoding = UT_ASCII
   end subroutine tear_down

end module Test_udunits2
